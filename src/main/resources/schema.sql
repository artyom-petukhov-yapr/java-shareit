DROP TABLE IF EXISTS item CASCADE;
DROP TABLE IF EXISTS account CASCADE;
DROP TABLE IF EXISTS booking CASCADE;
DROP TABLE IF EXISTS comment CASCADE;

CREATE TABLE IF NOT EXISTS account (
	id int GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
	email varchar NOT NULL UNIQUE,
	name varchar NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS item (
    id int GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
	owner_id int NOT NULL REFERENCES account(id) ON DELETE CASCADE,
    name varchar NOT NULL,
    description varchar NOT NULL,
    available boolean NOT NULL
);

CREATE TABLE IF NOT EXISTS booking (
    id int GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
    booker_id int NOT NULL REFERENCES account(id) ON DELETE CASCADE,
    item_id int NOT NULL REFERENCES item(id) ON DELETE CASCADE,
    start_date TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    end_date TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    status varchar default 'WAITING' CHECK (status IN ('APPROVED', 'WAITING', 'REJECTED', 'CANCELED'))
);

CREATE TABLE IF NOT EXISTS comment (
    id int GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
    author_id int NOT NULL REFERENCES account(id) ON DELETE CASCADE,
    item_id int NOT NULL REFERENCES item(id) ON DELETE CASCADE,
    text varchar NOT NULL,
    create_date TIMESTAMP WITHOUT TIME ZONE NOT NULL
);